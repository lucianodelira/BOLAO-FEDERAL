<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bolão Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0d0d0d;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  background: #1c1c1c;
  padding: 20px;
  border-radius: 10px;
  width: 100%;
  max-width: 360px;
  text-align: center;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 5px;
  border: none;
}

button {
  background: #00c853;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  background: #555;
}

#qr {
  margin-top: 15px;
}

img {
  width: 220px;
}
</style>
</head>

<body>

<div class="container">
  <h2>Bolão Loteria Federal</h2>

  <input id="nome" placeholder="Seu nome">
  <input id="telefone" placeholder="Telefone / WhatsApp">

  <button onclick="gerarPix()">GERAR PIX</button>

  <div id="status"></div>

  <div id="qr"></div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';

let paymentId = null;
let timer = null;

function gerarPix() {
  document.getElementById('status').innerText = 'Gerando PIX...';

  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'createPayment',
      nome: document.getElementById('nome').value,
      telefone: document.getElementById('telefone').value
    })
  })
  .then(r => r.json())
  .then(data => {
    if (!data.success) {
      document.getElementById('status').innerText = data.message;
      return;
    }

    paymentId = data.paymentId;

    document.getElementById('qr').innerHTML = `
      <img src="data:image/png;base64,${data.qrCodeBase64}">
      <p>${data.pixKey}</p>
    `;

    document.getElementById('status').innerText = 'Aguardando pagamento...';
    timer = setInterval(verificarPagamento, 5000);
  })
  .catch(err => {
    console.error(err);
    document.getElementById('status').innerText = 'Erro de conexão com o servidor';
  });
}

function verificarPagamento() {
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'checkPayment',
      paymentId: paymentId
    })
  })
  .then(r => r.json())
  .then(data => {
 if (d.status === 'PAID') {
    clearInterval(t);

    pixStatus.innerText = '✅ Pagamento aprovado!';
    
    loadBolao(); // <<< AQUI É O PONTO CERTO
  }
});
</script>


</body>
</html>
