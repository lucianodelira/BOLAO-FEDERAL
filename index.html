<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bolão Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0d0d0d;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  background: #1c1c1c;
  padding: 20px;
  border-radius: 10px;
  width: 100%;
  max-width: 360px;
  text-align: center;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 5px;
  border: none;
}

button {
  background: #00c853;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  background: #555;
}

#qr {
  margin-top: 15px;
}

img {
  width: 220px;
}
</style>
</head>

<body>

<div class="container">
  <h2>Bolão Loteria Federal</h2>

  <input id="nome" placeholder="Seu nome">
  <input id="telefone" placeholder="Telefone / WhatsApp">

  <button onclick="gerarPix()">GERAR PIX</button>

  <div id="status"></div>

  <div id="qr"></div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';
let paymentId = null;
let intervalo = null;

async function gerarPix() {
  document.getElementById('status').innerText = 'Gerando PIX...';

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'createPayment',
        nome: document.getElementById('nome').value,
        telefone: document.getElementById('telefone').value
      })
    });

    const data = await res.json();

    if (!data.success) {
      document.getElementById('status').innerText = data.message || 'Erro ao gerar PIX';
      return;
    }

    paymentId = data.paymentId;

    document.getElementById('qr').innerHTML = `
      <p>Escaneie o QR Code</p>
      <img src="data:image/png;base64,${data.qrCodeBase64}">
      <p style="word-break:break-all">${data.pixKey}</p>
    `;

    document.getElementById('status').innerText = 'Aguardando pagamento...';

    intervalo = setInterval(verificarPagamento, 5000);

  } catch (e) {
    document.getElementById('status').innerText = 'Erro de conexão com o servidor';
    console.error(e);
  }
}

async function verificarPagamento() {
  if (!paymentId) return;

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        action: 'checkPayment',
        paymentId: paymentId
      })
    });

    const data = await res.json();

    if (data.status === 'PAID') {
      clearInterval(intervalo);
      document.getElementById('status').innerText = '✅ Pagamento aprovado!';
    }

  } catch (e) {
    console.error('Erro ao verificar pagamento', e);
  }
}
</script>

</body>
</html>
