<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bol√£o Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #0d0d0d;
  color: #fff;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 20px;
  min-height: 100vh;
}

.container {
  background: #1c1c1c;
  padding: 20px;
  border-radius: 10px;
  width: 100%;
  max-width: 400px;
}

h2, h3 {
  text-align: center;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 5px;
  border: none;
}

button {
  background: #00c853;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  background: #555;
}

#qr img {
  width: 220px;
  margin-top: 10px;
}

ul {
  list-style: none;
  padding: 0;
  margin-top: 10px;
}

ul li {
  background: #1e1e1e;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 6px;
  font-size: 14px;
}

.hidden {
  display: none;
}

/* Painel admin */
#adminPanel {
  display: none;
  margin-top: 20px;
  background: #2a2a2a;
  padding: 15px;
  border-radius: 8px;
}
</style>
</head>
<body>

<div class="container" id="loginContainer">
  <h2>Bol√£o Loteria Federal</h2>
  <input id="nome" placeholder="Seu nome">
  <input id="telefone" placeholder="Telefone / WhatsApp">
  <button onclick="gerarPix()">GERAR PIX</button>
  <div id="status"></div>
  <div id="qr"></div>
</div>

<div class="container hidden" id="salaContainer">
  <h2>üë§ Bem-vindo, <span id="userNome"></span></h2>
  <p>Telefone: <span id="userTelefone"></span></p>

  <div>
    <button onclick="toggleParticipantes()">üë• Ver participantes ativos</button>
    <ul id="listaParticipantes" class="hidden"></ul>
  </div>

  <div>
    <h3>üéØ Palpites</h3>
    <div id="palpitesArea">(√°rea pronta para seus palpites)</div>
  </div>

  <div id="adminPanel">
    <h3>üõ†Ô∏è Painel Admin</h3>
    <button onclick="carregarParticipantesAdmin()">Atualizar lista completa</button>
    <ul id="adminLista"></ul>
  </div>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';

let paymentId = null;
let timer = null;

// Carrega login persistente
window.addEventListener('DOMContentLoaded', () => {
  const storedUser = JSON.parse(localStorage.getItem('bolaoUser'));
  if (storedUser) {
    abrirSala(storedUser.nome, storedUser.telefone);
  }
});

// Gerar PIX
function gerarPix() {
  const nome = document.getElementById('nome').value.trim();
  const telefone = document.getElementById('telefone').value.trim();

  if (!nome || !telefone) {
    alert('Preencha nome e telefone');
    return;
  }

  document.getElementById('status').innerText = 'Gerando PIX...';

  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'createPayment', nome, telefone })
  })
  .then(r => r.json())
  .then(data => {
    if (!data.success) {
      document.getElementById('status').innerText = data.message;
      return;
    }

    paymentId = data.paymentId;
    document.getElementById('qr').innerHTML = `
      <img src="data:image/png;base64,${data.qrCodeBase64}">
      <p>${data.pixKey}</p>
    `;

    document.getElementById('status').innerText = 'Aguardando pagamento...';
    timer = setInterval(() => verificarPagamento(nome, telefone), 5000);
  })
  .catch(err => {
    console.error(err);
    document.getElementById('status').innerText = 'Erro de conex√£o com o servidor';
  });
}

// Verificar status do PIX
function verificarPagamento(nome, telefone) {
  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action: 'checkPayment', paymentId })
  })
  .then(r => r.json())
  .then(d => {
    if (d.status === 'PAID') {
      clearInterval(timer);
      document.getElementById('status').innerText = '‚úÖ Pagamento aprovado!';
      // Salva login no localStorage
      localStorage.setItem('bolaoUser', JSON.stringify({ nome, telefone }));
      abrirSala(nome, telefone);
    }
  });
}

// Abrir sala do bol√£o
function abrirSala(nome, telefone) {
  document.getElementById('loginContainer').classList.add('hidden');
  document.getElementById('salaContainer').classList.remove('hidden');
  document.getElementById('userNome').innerText = nome;
  document.getElementById('userTelefone').innerText = telefone;
}

// Lista participantes
function toggleParticipantes() {
  const ul = document.getElementById('listaParticipantes');
  if (ul.classList.contains('hidden')) {
    ul.classList.remove('hidden');
    carregarParticipantes();
  } else {
    ul.classList.add('hidden');
  }
}

function carregarParticipantes() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(data => {
      const ul = document.getElementById('listaParticipantes');
      ul.innerHTML = '';
      if (!data.participantes || data.participantes.length === 0) {
        ul.innerHTML = '<li>Nenhum participante ativo</li>';
        return;
      }
      data.participantes.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.nome} - ${p.telefone}`;
        ul.appendChild(li);
      });
    });
}

// Painel admin
function carregarParticipantesAdmin() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(data => {
      const ul = document.getElementById('adminLista');
      ul.innerHTML = '';
      if (!data.participantes || data.participantes.length === 0) {
        ul.innerHTML = '<li>Nenhum participante</li>';
        return;
      }
      data.participantes.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.nome} - ${p.telefone}`;
        ul.appendChild(li);
      });
    });
}
</script>

</body>
</html>
