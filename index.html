<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bol√£o Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#f4f4f4; margin:0 }
header { background:#1d3557; color:#fff; padding:15px; text-align:center }
.container { max-width:900px; margin:auto; padding:20px }
.card { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px }
input, button { width:100%; padding:10px; margin-top:10px }
button { background:#1d3557; color:#fff; border:none; border-radius:6px }
.hidden { display:none }
.stats { display:flex; gap:10px }
.stats div { flex:1; background:#e9ecef; padding:10px; border-radius:8px; text-align:center }
</style>
</head>

<body>

<header>
<h1>üéüÔ∏è Bol√£o da Loteria Federal</h1>
<p>Valor da cota: R$ 18,00 | Total: 200 cotas</p>
</header>

<div class="container">

<div class="card">
<h3>Entrar no Bol√£o</h3>
<input id="name" placeholder="Nome completo">
<input id="phone" placeholder="Telefone (WhatsApp)">
<button id="btnPix" onclick="startPayment()">Gerar PIX</button>
</div>

<div class="card hidden" id="pixArea">
<h3>Pagamento PIX</h3>
<img id="pixQr" width="220"><br><br>
<input id="pixCopia" readonly>
<p id="pixStatus">Aguardando pagamento...</p>
</div>

<div class="card">
<h3>Status do Bol√£o</h3>
<div class="stats">
<div><strong id="freeCotas">200</strong><br>Dispon√≠veis</div>
<div><strong id="usedCotas">0</strong><br>Ocupadas</div>
<div><strong>200</strong><br>Total</div>
</div>
</div>

</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';
let paymentId = null;

function startPayment() {
  const btn = document.getElementById('btnPix');
  btn.disabled = true;
  btn.innerText = 'Gerando PIX...';

  const nome = document.getElementById('name').value.trim();
  const telefone = document.getElementById('phone').value.trim();

  if (!nome || !telefone) {
    alert('Preencha nome e telefone');
    btn.disabled = false;
    btn.innerText = 'Gerar PIX';
    return;
  }

  fetch(API_URL, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ action:'createPayment', nome, telefone })
  })
  .then(r => r.json())
  .then(d => {
    if (!d.success) {
      alert(d.message);
      btn.disabled = false;
      btn.innerText = 'Gerar PIX';
      return;
    }

    paymentId = d.paymentId;
    pixQr.src = 'data:image/png;base64,' + d.qrCodeBase64;
    pixCopia.value = d.pixKey;
    pixArea.classList.remove('hidden');
    btn.innerText = 'PIX Gerado';
    checkPayment();
  })
  .catch(() => {
    alert('Erro de conex√£o com o servidor');
    btn.disabled = false;
    btn.innerText = 'Gerar PIX';
  });
}

function checkPayment() {
  const timer = setInterval(() => {
    fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ action:'checkPayment', paymentId })
    })
    .then(r => r.json())
    .then(d => {
      if (d.status === 'PAID') {
        clearInterval(timer);
        pixStatus.innerText = 'Pagamento confirmado üéâ';
      }
    });
  }, 5000);
}
</script>

</body>
</html>
