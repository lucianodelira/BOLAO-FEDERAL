<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>BolÃ£o Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }

body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #fff;
  min-height: 100vh;
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.card {
  background: #111;
  width: 100%;
  max-width: 380px;
  padding: 25px;
  border-radius: 14px;
  box-shadow: 0 10px 40px rgba(0,0,0,.6);
  text-align: center;
}

h2 {
  margin-bottom: 15px;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}

input {
  background: #222;
  color: #fff;
}

button {
  background: #00e676;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  background: #555;
  cursor: not-allowed;
}

#qr img {
  width: 220px;
  margin: 15px auto;
}

.status {
  margin-top: 10px;
  font-weight: bold;
}

.hidden {
  display: none;
}

/* SALA */
.sala {
  text-align: left;
}

.sala h3 {
  margin-top: 0;
}

.lista {
  background: #1e1e1e;
  border-radius: 8px;
  padding: 10px;
  margin-top: 10px;
  max-height: 180px;
  overflow-y: auto;
}

.lista div {
  padding: 6px;
  border-bottom: 1px solid #333;
}
</style>
</head>

<body>

<!-- TELA PAGAMENTO -->
<div class="card" id="telaPagamento">
  <h2>ğŸŸï¸ BolÃ£o Loteria Federal</h2>

  <input id="nome" placeholder="Seu nome completo">
  <input id="telefone" placeholder="Telefone / WhatsApp">

  <button onclick="gerarPix()">GERAR PIX</button>

  <div class="status" id="status"></div>
  <div id="qr"></div>
</div>

<!-- SALA -->
<div class="card hidden sala" id="telaSala">
  <h3>ğŸ‘‹ Bem-vindo, <span id="nomeUsuario"></span></h3>
  <p>VocÃª estÃ¡ oficialmente no bolÃ£o!</p>

  <h4>ğŸ‘¥ Participantes</h4>
  <div class="lista" id="listaParticipantes"></div>

  <h4 style="margin-top:15px">ğŸ¯ Seus palpites</h4>
  <p style="font-size:13px;color:#ccc">
    (Ã¡rea pronta para vocÃª adicionar os palpites depois)
  </p>
</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';

let paymentId = null;
let timer = null;
let nomeCliente = '';

function gerarPix() {
  nomeCliente = nome.value.trim();
  const tel = telefone.value.trim();

  if (!nomeCliente || !tel) {
    status.innerText = 'Preencha nome e telefone';
    return;
  }

  status.innerText = 'â³ Gerando PIX...';

  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'createPayment',
      nome: nomeCliente,
      telefone: tel
    })
  })
  .then(r => r.json())
  .then(data => {
    if (!data.success) {
      status.innerText = data.message;
      return;
    }

    paymentId = data.paymentId;

    qr.innerHTML = `
      <img src="data:image/png;base64,${data.qrCodeBase64}">
      <p style="font-size:12px;word-break:break-all">${data.pixKey}</p>
    `;

    status.innerText = 'ğŸ’³ Aguardando pagamento...';
    timer = setInterval(verificarPagamento, 5000);
  })
  .catch(() => {
    status.innerText = 'Erro de conexÃ£o com o servidor';
  });
}

function verificarPagamento() {
  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'checkPayment',
      paymentId
    })
  })
  .then(r => r.json())
  .then(data => {
    if (data.status === 'PAID') {
      clearInterval(timer);
      entrarNaSala();
    }
  });
}

function entrarNaSala() {
  telaPagamento.classList.add('hidden');
  telaSala.classList.remove('hidden');
  nomeUsuario.innerText = nomeCliente;
  carregarParticipantes();
}

function carregarParticipantes() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(data => {
      listaParticipantes.innerHTML = '';
      data.participantes.forEach(p => {
        const div = document.createElement('div');
        div.innerText = `${p.nome} - ${p.telefone}`;
        listaParticipantes.appendChild(div);
      });
    });
}
</script>

</body>
</html>

