<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sala do Bol√£o - Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #fff;
}

.hidden { display: none; }

.container {
  max-width: 380px;
  margin: 40px auto;
  background: #111;
  padding: 22px;
  border-radius: 14px;
}

h2, h3 {
  text-align: center;
  margin-top: 0;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}

input {
  background: #1e1e1e;
  color: #fff;
}

button {
  background: #00e676;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

.status {
  margin-top: 10px;
  text-align: center;
}

.qr img {
  width: 220px;
  margin-top: 10px;
}

.pixkey {
  background: #1c1c1c;
  padding: 8px;
  border-radius: 6px;
  margin-top: 6px;
  word-break: break-all;
  font-size: 13px;
}

/* SALA */
.sala {
  max-width: 800px;
  margin: auto;
  padding: 20px;
}

.card {
  background: #121212;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 15px;
}

ul {
  padding-left: 18px;
}


ul {
  margin-top: 10px;
}

ul li {
  background: #1e1e1e;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 6px;
  font-size: 14px;
}



  
</style>
</head>

<body>

<!-- LOGIN / PIX -->
<div class="container" id="loginArea">
  <h2>üéüÔ∏è Bol√£o Loteria Federal</h2>

  <input id="nome" placeholder="Seu nome completo">
  <input id="telefone" placeholder="Telefone / WhatsApp">

  <button onclick="gerarPix()">GERAR PIX</button>

  <div class="status" id="status"></div>
  <div class="qr" id="qr"></div>
</div>

<!-- SALA -->
<div class="sala hidden" id="salaBolao">

  <h2>üéâ Sala do Bol√£o</h2>

  <div class="card">
    <h3>üë§ Seus dados</h3>
    <p><strong>Nome:</strong> <span id="meuNome"></span></p>
    <p><strong>Telefone:</strong> <span id="meuTelefone"></span></p>
  </div>

  <div class="card">
  <h3>üë• Participantes do Bol√£o</h3>

  <button onclick="toggleParticipantes()" style="margin-bottom:10px">
    Ver participantes
  </button>

  <ul id="listaParticipantes" class="hidden"></ul>
</div>


<h3>üéØ Pule do Bol√£o</h3>
<button onclick="gerarPule()" style="margin-bottom:10px">Gerar Pule</button>
<div id="puleContainer" class="hidden" style="display:grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>




</div>
<button onclick="gerarPule()">Gerar Pule</button>
<div id="puleContainer" class="hidden"></div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';

let nomeCliente='', telefoneCliente='', idCliente='';

// login
function entrar(){
  nomeCliente = document.getElementById('nome').value.trim();
  telefoneCliente = document.getElementById('telefone').value.trim();
  if(!nomeCliente || !telefoneCliente){alert('Preencha os dados'); return;}

  // busca o participante pelo nome e telefone
  fetch(`${API_URL}?action=infoBolao`)
    .then(r=>r.json())
    .then(data=>{
      const participante = data.participantes.find(p=>p.nome===nomeCliente && p.telefone===telefoneCliente);
      if(!participante){alert('Participante n√£o encontrado ou inativo'); return;}
      idCliente = participante.id;
      localStorage.setItem('bolao_nome', nomeCliente);
      localStorage.setItem('bolao_telefone', telefoneCliente);
      localStorage.setItem('bolao_id', idCliente);
      abrirSala();
    });
}

function abrirSala(){
  document.getElementById('loginArea').classList.add('hidden');
  document.getElementById('salaBolao').classList.remove('hidden');
  document.getElementById('meuNome').innerText = nomeCliente;
  document.getElementById('meuTelefone').innerText = telefoneCliente;
  carregarParticipantes();
}

function carregarParticipantes(){
  fetch(`${API_URL}?action=infoBolao`)
  .then(r=>r.json())
  .then(data=>{
    const ul=document.getElementById('listaParticipantes');
    ul.innerHTML='';
    data.participantes.forEach(p=>{
      const li=document.createElement('li'); li.textContent=p.nome; ul.appendChild(li);
    });
  });
}

function toggleParticipantes(){document.getElementById('listaParticipantes').classList.toggle('hidden');}

function gerarPule(){
  const div=document.getElementById('puleContainer');
  div.classList.remove('hidden'); div.innerHTML='Carregando...';
  fetch(`${API_URL}?action=getPule&id=${idCliente}`)
  .then(r=>r.json())
  .then(data=>{
    div.innerHTML='';
    if(!data.success){div.innerHTML=`<p>${data.message}</p>`; return;}
    const { participante, numeros } = data;

    const card=document.createElement('div');
    card.style.background='#1e1e1e'; card.style.padding='8px'; card.style.borderRadius='6px'; card.style.gridColumn='1 / -1';
    card.innerHTML = `<strong>${participante.nome}</strong><br>${participante.telefone}<br>ID: ${participante.id}<br><br>
      <button onclick="compartilharPule()">Compartilhar Tudo no WhatsApp</button>`;
    div.appendChild(card);

    numeros.forEach(n=>{
      const cell=document.createElement('div'); cell.style.background='#1e1e1e'; cell.style.padding='6px';
      cell.style.borderRadius='4px'; cell.style.fontSize='14px'; cell.textContent = n; div.appendChild(cell);
    });
  });
}

function compartilharPule(){
  const numeros = Array.from(document.querySelectorAll('#puleContainer > div:not(:first-child)')).map(d=>d.textContent);
  fetch(API_URL,{method:'POST',body:JSON.stringify({action:'compartilharPule',id:idCliente,numeros})})
    .then(r=>r.json())
    .then(data=>{
      if(data.success){
        const texto=`Minha pule:\nNome: ${nomeCliente}\nTelefone: ${telefoneCliente}\nN√∫meros: ${numeros.join(', ')}`;
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(texto)}`,'_blank');
      }else{alert('Erro: '+data.message);}
    });
}

// auto login
if(localStorage.getItem('bolao_nome') && localStorage.getItem('bolao_telefone') && localStorage.getItem('bolao_id')){
  nomeCliente=localStorage.getItem('bolao_nome');
  telefoneCliente=localStorage.getItem('bolao_telefone');
  idCliente=localStorage.getItem('bolao_id');
  abrirSala();
}
</script>

</body>
</html>
