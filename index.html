<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Bol√£o Loteria Federal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="Styles.css" />

  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:0 }
    header { background:#1d3557; color:#fff; padding:15px; text-align:center }
    .container { padding:20px; max-width:900px; margin:auto }
    .card { background:#fff; padding:20px; border-radius:10px; margin-bottom:20px }
    input, button { padding:10px; width:100%; margin-top:10px }
    button { background:#1d3557; color:#fff; border:none; border-radius:6px; cursor:pointer }
    button:disabled { background:#999 }
    .stats { display:flex; justify-content:space-between; gap:10px }
    .stats div { flex:1; background:#e9ecef; padding:10px; border-radius:8px; text-align:center }
    ul { list-style:none; padding:0 }
    li { padding:8px; border-bottom:1px solid #ddd }
    .hidden { display:none }
  </style>
</head>

<body>

<header>
  <h1>üéüÔ∏è Bol√£o da Loteria Federal</h1>
  <p>Valor da cota: R$ 18,00 | Total: 200 cotas</p>
</header>

<div class="container">

  <!-- CADASTRO -->
  <div class="card" id="registerCard">
    <h2>Entrar no Bol√£o</h2>
    <input type="text" id="name" placeholder="Seu nome completo" />
    <input type="tel" id="phone" placeholder="Seu telefone (WhatsApp)" />
    <button onclick="startPayment()">Gerar PIX e Participar</button>
  </div>

  <!-- PIX -->
  <div class="card hidden" id="pixArea">
    <h3>Pagamento PIX</h3>
    <img id="pixQr" style="width:220px" />
    <input id="pixCopia" readonly />
    <p id="pixStatus">Aguardando pagamento...</p>
  </div>

  <!-- STATUS -->
  <div class="card">
    <h3>Status do Bol√£o</h3>
    <div class="stats">
      <div>
        <strong id="freeCotas">200</strong><br>Dispon√≠veis
      </div>
      <div>
        <strong id="usedCotas">0</strong><br>Ocupadas
      </div>
      <div>
        <strong>200</strong><br>Total
      </div>
    </div>
  </div>

  <!-- PARTICIPANTES -->
  <div class="card">
    <h3>üë• Participantes</h3>
    <ul id="participantsList"></ul>
  </div>

</div>

<!-- SCRIPT √öNICO -->
<script>
/* ================= CONFIG ================= */

// üî¥ COLE A URL DO SEU WEB APP AQUI
const API_URL = 'https://script.google.com/macros/s/AKfycbzS32wgwNYZhNQhXQ17OSQUx56NbRuZmrv5l0Hi2cm7k_0WzqZ-BtfQy3BIKzoQZaId/exec';

let paymentId = null;

/* ================= FUN√á√ïES ================= */

function startPayment() {
  const nome = document.getElementById('name').value.trim();
  const telefone = document.getElementById('phone').value.trim();

  if (!nome || !telefone) {
    alert('Preencha nome e telefone');
    return;
  }

  fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'createPayment',
      nome,
      telefone
    })
  })
  .then(r => r.json())
  .then(d => {
    if (!d.success) {
      alert(d.message || 'Erro ao gerar PIX');
      return;
    }

    paymentId = d.paymentId;

    document.getElementById('pixQr').src =
      'data:image/png;base64,' + d.qrCodeBase64;

    document.getElementById('pixCopia').value = d.pixKey;
    document.getElementById('pixArea').classList.remove('hidden');

    verificarPagamento();
  })
  .catch(() => {
    alert('Erro de conex√£o com o servidor');
  });
}

function verificarPagamento() {
  const timer = setInterval(() => {
    fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        action: 'checkPayment',
        paymentId
      })
    })
    .then(r => r.json())
    .then(d => {
      if (d.status === 'PAID') {
        clearInterval(timer);
        document.getElementById('pixStatus').innerText =
          'Pagamento confirmado üéâ';
        carregarSala();
      }
    });
  }, 5000);
}

function carregarSala() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(d => {
      document.getElementById('usedCotas').innerText = d.ocupadas;
      document.getElementById('freeCotas').innerText =
        d.total - d.ocupadas;

      const ul = document.getElementById('participantsList');
      ul.innerHTML = '';

      d.participantes.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.nome + ' - ' + p.telefone;
        ul.appendChild(li);
      });
    });
}

/* ================= INIT ================= */

carregarSala();
</script>

</body>
</html>
