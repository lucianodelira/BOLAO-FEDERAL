<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sala do BolÃ£o - Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #fff;
}

.hidden { display: none; }

.container {
  max-width: 380px;
  margin: 40px auto;
  background: #111;
  padding: 22px;
  border-radius: 14px;
}

h2, h3 {
  text-align: center;
  margin-top: 0;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  font-size: 15px;
}

input {
  background: #1e1e1e;
  color: #fff;
}

button {
  background: #00e676;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

.status {
  margin-top: 10px;
  text-align: center;
}

.qr img {
  width: 220px;
  margin-top: 10px;
}

.pixkey {
  background: #1c1c1c;
  padding: 8px;
  border-radius: 6px;
  margin-top: 6px;
  word-break: break-all;
  font-size: 13px;
}

/* SALA */
.sala {
  max-width: 800px;
  margin: auto;
  padding: 20px;
}

.card {
  background: #121212;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 15px;
}

ul {
  padding-left: 18px;
}


ul {
  margin-top: 10px;
}

ul li {
  background: #1e1e1e;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 6px;
  font-size: 14px;
}



  
</style>
</head>

<body>

<!-- LOGIN / PIX -->
<div class="container" id="loginArea">
  <h2>ğŸŸï¸ BolÃ£o Loteria Federal</h2>

  <input id="nome" placeholder="Seu nome completo">
  <input id="telefone" placeholder="Telefone / WhatsApp">

  <button onclick="gerarPix()">GERAR PIX</button>

  <div class="status" id="status"></div>
  <div class="qr" id="qr"></div>
</div>

<!-- SALA -->
<div class="sala hidden" id="salaBolao">

  <h2>ğŸ‰ Sala do BolÃ£o</h2>

  <div class="card">
    <h3>ğŸ‘¤ Seus dados</h3>
    <p><strong>Nome:</strong> <span id="meuNome"></span></p>
    <p><strong>Telefone:</strong> <span id="meuTelefone"></span></p>
  </div>

  <div class="card">
  <h3>ğŸ‘¥ Participantes do BolÃ£o</h3>

  <button onclick="toggleParticipantes()" style="margin-bottom:10px">
    Ver participantes
  </button>

  <ul id="listaParticipantes" class="hidden"></ul>
</div>


  <div class="card">
    <h3>ğŸ¯ Palpites</h3>
    <p>(os palpites serÃ£o exibidos aqui)</p>
  </div>

</div>

<script>
const API_URL = 'https://script.google.com/macros/s/AKfycbyyFITAR_NOlCc1zNuML7omJrSZje84pWC9e5zu0-5DNxnmoVcSkHyYzHJujcfC_VzZ/exec';

let paymentId = null;
let timer = null;
let nomeCliente = '';
let telefoneCliente = '';

/* ================= AUTO LOGIN ================= */
const auth = JSON.parse(localStorage.getItem('bolao_auth'));
if (auth && auth.expires > Date.now()) {
  entrarNaSala(auth.nome, auth.telefone);
}

/* ================= PIX ================= */
function gerarPix() {
  nomeCliente = nome.value.trim();
  telefoneCliente = telefone.value.trim();

  if (!nomeCliente || !telefoneCliente) {
    status.innerText = 'Preencha todos os dados';
    return;
  }

  status.innerText = 'Gerando PIX...';

  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'createPayment',
      nome: nomeCliente,
      telefone: telefoneCliente
    })
  })
  .then(r => r.json())
  .then(data => {
    if (!data.success) {
      status.innerText = data.message;
      return;
    }

    paymentId = data.paymentId;

    qr.innerHTML = `
      <img src="data:image/png;base64,${data.qrCodeBase64}">
      <div class="pixkey">${data.pixKey}</div>
    `;

    status.innerText = 'â³ Aguardando pagamento...';
    timer = setInterval(verificarPagamento, 5000);
  });
}

function verificarPagamento() {
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'checkPayment',
      paymentId
    })
  })
  .then(r => r.json())
  .then(data => {
    if (data.status === 'PAID') {
      clearInterval(timer);

      localStorage.setItem('bolao_auth', JSON.stringify({
        nome: nomeCliente,
        telefone: telefoneCliente,
        expires: Date.now() + (24 * 60 * 60 * 1000) // 24 horas
      }));

      entrarNaSala(nomeCliente, telefoneCliente);
    }
  });
}

/* ================= SALA ================= */
function entrarNaSala(nome, telefone) {
  loginArea.classList.add('hidden');
  salaBolao.classList.remove('hidden');

  meuNome.innerText = nome;
  meuTelefone.innerText = telefone;

  carregarParticipantes();
}

function carregarParticipantes() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(data => {
      listaParticipantes.innerHTML = '';
      data.participantes.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.nome;
        listaParticipantes.appendChild(li);
      });
    });
}



function toggleParticipantes() {
  const ul = document.getElementById('listaParticipantes');

  if (ul.classList.contains('hidden')) {
    ul.classList.remove('hidden');
    carregarParticipantes();
  } else {
    ul.classList.add('hidden');
  }
}

function carregarParticipantes() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(data => {
      const ul = document.getElementById('listaParticipantes');
      ul.innerHTML = '';

      if (!data.participantes || data.participantes.length === 0) {
        ul.innerHTML = '<li>Nenhum participante confirmado ainda</li>';
        return;
      }

      data.participantes.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.nome;
        ul.appendChild(li);
      });
    });
}


  
</script>

</body>
</html>
