<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sala do BolÃ£o - Loteria Federal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color: #fff;
}
.hidden { display: none; }
.container {
  max-width: 380px;
  margin: 40px auto;
  background: #111;
  padding: 22px;
  border-radius: 14px;
}
input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
}
input { background: #1e1e1e; color: #fff; }
button { background: #00e676; font-weight: bold; cursor: pointer; }
.card {
  background:#121212;
  padding:16px;
  border-radius:12px;
  margin-bottom:15px;
}
ul li {
  background:#1e1e1e;
  padding:8px;
  border-radius:6px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<div class="container" id="loginArea">
  <h2>ğŸŸï¸ BolÃ£o Loteria Federal</h2>
  <input id="nome" placeholder="Seu nome completo">
  <input id="telefone" placeholder="Telefone / WhatsApp">
  <button onclick="gerarPix()">GERAR PIX</button>
  <div id="status"></div>
  <div id="qr"></div>
</div>

<div class="container hidden" id="salaBolao">
  <h2>ğŸ‰ Sala do BolÃ£o</h2>

  <div class="card">
    <strong>ğŸ‘¤ Nome:</strong> <span id="meuNome"></span><br>
    <strong>ğŸ“ Telefone:</strong> <span id="meuTelefone"></span>
  </div>

  <div class="card">
    <button onclick="toggleParticipantes()">Ver participantes</button>
    <ul id="listaParticipantes" class="hidden"></ul>
  </div>

  <button onclick="gerarPule()">ğŸ¯ Gerar Pule</button>
  <div id="puleContainer"></div>
</div>

<script>
const API_URL = 'COLE_AQUI_A_URL_DO_WEB_APP';

let nomeCliente = '';
let telefoneCliente = '';
let paymentId = null;
let timer = null;

/* ========= AUTO LOGIN ========= */
window.onload = () => {
  const nome = localStorage.getItem('bolao_nome');
  const telefone = localStorage.getItem('bolao_telefone');
  if (nome && telefone) {
    nomeCliente = nome;
    telefoneCliente = telefone;
    entrarNaSala(nome, telefone);
  }
};

/* ========= PIX ========= */
function gerarPix() {
  nomeCliente = nome.value.trim();
  telefoneCliente = telefone.value.trim();

  if (!nomeCliente || !telefoneCliente) {
    status.innerText = 'Preencha nome e telefone';
    return;
  }

  localStorage.setItem('bolao_nome', nomeCliente);
  localStorage.setItem('bolao_telefone', telefoneCliente);

  status.innerText = 'Gerando PIX...';

  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'createPayment',
      nome: nomeCliente,
      telefone: telefoneCliente
    })
  })
  .then(r => r.json())
  .then(d => {
    if (!d.success) {
      status.innerText = d.message;
      return;
    }

    paymentId = d.paymentId;
    qr.innerHTML = `
      <img width="220" src="data:image/png;base64,${d.qrCodeBase64}">
      <div>${d.pixKey}</div>
    `;
    status.innerText = 'â³ Aguardando pagamento...';
    timer = setInterval(verificarPagamento, 5000);
  });
}

function verificarPagamento() {
  fetch(API_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'checkPayment',
      paymentId
    })
  })
  .then(r => r.json())
  .then(d => {
    if (d.status === 'PAID') {
      clearInterval(timer);
      entrarNaSala(nomeCliente, telefoneCliente);
    }
  });
}

/* ========= SALA ========= */
function entrarNaSala(nome, telefone) {
  loginArea.classList.add('hidden');
  salaBolao.classList.remove('hidden');
  meuNome.innerText = nome;
  meuTelefone.innerText = telefone;
  carregarParticipantes();
}

function carregarParticipantes() {
  fetch(API_URL + '?action=infoBolao')
    .then(r => r.json())
    .then(d => {
      listaParticipantes.innerHTML = '';
      d.participantes.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${p.nome} - ${p.telefone}`;
        listaParticipantes.appendChild(li);
      });
    });
}

function toggleParticipantes() {
  listaParticipantes.classList.toggle('hidden');
}

/* ========= PULE ========= */
function gerarPule() {
  fetch(API_URL + '?action=getPule')
    .then(r => r.json())
    .then(d => {
      puleContainer.innerHTML = `
        <div class="card">
          <strong>ğŸŸï¸ PULE DO BOLÃƒO</strong><br><br>
          ğŸ‘¤ Nome: ${nomeCliente}<br>
          ğŸ“ Telefone: ${telefoneCliente}<br>
          ğŸ” CÃ³digo: <strong>${d.codigo}</strong><br><br>
          ğŸ¯ NÃºmeros:<br>${d.numeros.join(', ')}
        </div>
      `;
    });
}
</script>
</body>
</html>
